<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catch My Love ‚ù§Ô∏è</title>
  <style>
    /* Base */
    :root {
      --bg1: #ff9a9e;
      --bg2: #fad0c4;
      --text: #ffffff;
      --accent: #ff6b6b;
      --accent-hover: #ff4757;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
      background: linear-gradient(to top, var(--bg1), var(--bg2));
      color: var(--text);
      /* Prevent pull-to-refresh/scroll during play on mobile */
      overscroll-behavior: none;
      touch-action: none;
    }

    /* Use dynamic viewport height for mobile UI bars */
    #gameArea {
      position: relative;
      width: 100vw;
      height: 100dvh; /* better on mobile than 100vh */
      overflow: hidden;
    }

    /* Player scales with screen size but caps at desktop size */
    #player {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: min(12vw, 50px);
      line-height: 1;
      user-select: none;
      -webkit-user-select: none;
      pointer-events: none; /* allow touches to pass through */
    }

    /* Falling items also scale */
    .falling {
      position: absolute;
      font-size: min(8vw, 30px);
      line-height: 1;
      animation: fall linear forwards;
      will-change: transform;
      user-select: none;
      -webkit-user-select: none;
    }

    @keyframes fall {
      from { transform: translateY(-50px); }
      to { transform: translateY(100dvh); }
    }

    #scoreBoard, #livesBoard {
      position: absolute;
      top: 16px;
      font-size: clamp(14px, 3.2vw, 20px);
      font-weight: 700;
      text-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }
    #scoreBoard { left: 16px; }
    #livesBoard { right: 16px; }

    #message {
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: clamp(16px, 3.6vw, 22px);
      font-weight: 700;
      color: #d6336c;
      display: none;
      text-align: center;
      max-width: 560px;
      padding: 0 16px;
    }

    button {
      margin-top: 16px;
      padding: 14px 28px;
      font-size: clamp(14px, 3.6vw, 18px);
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background .25s ease;
    }
    button:hover { background: var(--accent-hover); }

    /* On very small devices keep everything accessible */
    @media (max-width: 360px) {
      #player { bottom: 12px; }
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <div id="scoreBoard">Score: 0</div>
    <div id="livesBoard">Lives: 3</div>
    <div id="player" aria-label="player">ü™º</div>
    <div id="message">
      <button id="playAgainBtn">Play Again</button>
      <div style="margin-top:8px">
        <button id="tiltBtn" style="background:#845EF7">Enable Tilt Control</button>
      </div>
    </div>
  </div>

  <script>
    const gameArea = document.getElementById("gameArea");
    const player = document.getElementById("player");
    const scoreBoard = document.getElementById("scoreBoard");
    const livesBoard = document.getElementById("livesBoard");
    const message = document.getElementById("message");
    const playAgainBtn = document.getElementById("playAgainBtn");
    const tiltBtn = document.getElementById("tiltBtn");

    let score = 0;
    let lives = 5;
    let gameOver = false;
    let dropTimer = null;

    // --- Controls ---
    // Mouse (desktop)
    document.addEventListener("mousemove", (e) => {
      movePlayerTo(e.clientX);
    });

    // Keyboard (desktop)
    document.addEventListener("keydown", (e) => {
      const step = Math.max(24, Math.round(window.innerWidth * 0.04));
      let pos = player.offsetLeft;
      if (e.key === "ArrowLeft") movePlayerTo(pos - step + player.offsetWidth / 2);
      if (e.key === "ArrowRight") movePlayerTo(pos + step + player.offsetWidth / 2);
    });

    // Touch (mobile)
    gameArea.addEventListener("touchmove", (e) => {
      const t = e.touches[0];
      if (!t) return;
      e.preventDefault(); // prevent page scroll while playing
      movePlayerTo(t.clientX);
    }, { passive: false });

    // Optional: Tilt control (requires permission on iOS)
    let tiltEnabled = false;
    let lastGamma = 0;
    tiltBtn.addEventListener('click', async () => {
      try {
        if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
          const perm = await DeviceMotionEvent.requestPermission();
          if (perm !== 'granted') return;
        }
        tiltEnabled = true;
        tiltBtn.textContent = 'Tilt Enabled';
        tiltBtn.disabled = true;
      } catch (err) {
        console.warn('Tilt permission error:', err);
      }
    });

    window.addEventListener('deviceorientation', (e) => {
      if (!tiltEnabled) return;
      const gamma = e.gamma; // left-right tilt
      if (gamma == null) return;
      // Normalize tilt to screen width
      const maxTilt = 45; // degrees considered full range
      const clamped = Math.max(-maxTilt, Math.min(maxTilt, gamma));
      const center = window.innerWidth / 2;
      const range = (window.innerWidth - player.offsetWidth) / 2;
      const offset = (clamped / maxTilt) * range;
      movePlayerTo(center + offset);
      lastGamma = gamma;
    });

    function movePlayerTo(clientX) {
      const half = player.offsetWidth / 2;
      let x = clientX - half;
      x = Math.max(0, Math.min(window.innerWidth - player.offsetWidth, x));
      player.style.left = x + 'px';
    }

    // --- Game Logic ---
    function getItemType() {
      const rand = Math.random() * 100;
      if (rand < 30) return '‚ù§Ô∏è'; // 30% good
      return 'üíî'; // 70% bad
    }

    function createItem() {
      if (gameOver) return;
      const item = document.createElement('div');
      item.classList.add('falling');
      const type = getItemType();
      item.textContent = type;
      item.style.left = Math.random() * (window.innerWidth - 30) + 'px';
      item.style.animationDuration = (Math.random() * 2 + 3) + 's';
      gameArea.appendChild(item);

      // Collision loop using rAF for smoother checks
      let alive = true;
      function check() {
        if (!alive || gameOver) return;
        const itemRect = item.getBoundingClientRect();
        const playerRect = player.getBoundingClientRect();

        const overlap = !(
          itemRect.right < playerRect.left ||
          itemRect.left > playerRect.right ||
          itemRect.bottom < playerRect.top ||
          itemRect.top > playerRect.bottom
        );

        if (overlap) {
          if (type === '‚ù§Ô∏è') {
            score++;
            scoreBoard.textContent = 'Score: ' + score;
            if (score >= 7) endGame(true);
          } else {
            lives--;
            livesBoard.textContent = 'Lives: ' + lives;
            if (lives <= 0) endGame(false);
          }
          item.remove();
          alive = false;
          return;
        }

        if (itemRect.top > window.innerHeight) {
          item.remove();
          alive = false;
          return;
        }
        requestAnimationFrame(check);
      }
      requestAnimationFrame(check);

      // Safety cleanup in case animation ends but rAF lingers
      setTimeout(() => { if (item.parentNode) item.remove(); alive = false; }, 7000);
    }

    function startDrops() {
      dropTimer = setInterval(createItem, 800);
    }

    function stopDrops() {
      if (dropTimer) clearInterval(dropTimer);
      dropTimer = null;
    }

    function endGame(win) {
      stopDrops();
      document.querySelectorAll('.falling').forEach(el => el.remove());
      gameOver = true;
      message.innerHTML = `${win ?
        `Just like you ignored all the broken heart emojis right now, promise me to ignore it for the entire life, let there be no heartbreak between us and we'll live happily ever after. I love you.` :
        `Even if some hearts break along the way, I will always be here with you. Together we‚Äôll turn every heartbreak into love, and nothing can shake us.`}
        <br><button id="playAgainBtn">${win ? 'Play Again' : 'Try Again'}</button>
        <div style="margin-top:8px"><button id="tiltBtn" style="background:#845EF7">Enable Tilt Control</button></div>`;
      message.style.display = 'block';

      // Rebind buttons in the new HTML
      document.getElementById('playAgainBtn').addEventListener('click', () => location.reload());
      document.getElementById('tiltBtn').addEventListener('click', async () => {
        try {
          if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
            const perm = await DeviceMotionEvent.requestPermission();
            if (perm !== 'granted') return;
          }
          tiltEnabled = true;
          const btn = document.getElementById('tiltBtn');
          btn.textContent = 'Tilt Enabled';
          btn.disabled = true;
        } catch (err) { console.warn(err); }
      });
    }

    // Prevent page scroll when swiping in game area (extra safety)
    document.body.addEventListener('touchmove', (e) => {
      e.preventDefault();
    }, { passive: false });

    // Start game
    startDrops();
  </script>
</body>
</html>

